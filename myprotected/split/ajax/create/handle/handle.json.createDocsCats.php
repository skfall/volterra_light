<?php 	//********************	//** WEB MIRACLE TECHNOLOGIES	//********************		// get post		$appTable = $_POST['appTable'];		$item_id = (isset($_POST['item_id']) ? $_POST['item_id'] : 0);		$cardUpd = array(					'name'			=> $_POST['name'],					'alias'			=> $_POST['alias'],										'block'			=> $_POST['block'][0],					'modified' => date("Y-m-d H:i:s", time())	);	$data['item_id'] = $item_id;		// File upload filename		$file_path = "../../../../split/files/docs/";		// PREVIEW ------------------		$im_1_filename = "icon";		$im_1 		= false;		$im_1_name 	= 5;		$im_1_pre 	= "dic_";				if(isset($_FILES[$im_1_filename]) && $_FILES[$im_1_filename]['size'] > 0)		{			$im_1 		= true;		}				if($im_1)		{			$file_update = false;			$file_update = $ah->mtvc_add_files_file(array(					'path'			=>$file_path,					'name'			=>$im_1_name,					'pre'			=>$im_1_pre,					'size'			=>10,					'rule'			=>0,					'max_w'			=>2500,					'max_h'			=>2500,					'files'			=>$im_1_filename				  ));			if($file_update){				$cardUpd[$im_1_filename] = $file_update;			}		}		// Create main table item		$query = "INSERT INTO [pre]$appTable ";		$fieldsStr = " ( ";		$valuesStr = " ( ";		$cntUpd = 0;	foreach($cardUpd as $field => $itemUpd)	{		$cntUpd++;				$fieldsStr .= ($cntUpd==1 ? "`$field`" : ", `$field`");				$valuesStr .= ($cntUpd==1 ? "'$itemUpd'" : ", '$itemUpd'");	}		$fieldsStr .= " ) ";		$valuesStr .= " ) ";		$query .= $fieldsStr." VALUES ".$valuesStr;			$item_id = $ah->rs($query,0,1,1);	if($item_id)	{				$filename = "docs";				if(isset($_FILES[$filename]) && count($_FILES[$filename]) > 0)		{			$file_path = "../../../../split/files/docs/";						$files_upload = $ah->mtvc_add_files_file_miltiple(array(					'path'			=>$file_path,					'name'			=>5,					'pre'			=>"doc_",					'size'			=>10,					'rule'			=>0,					'max_w'			=>2500,					'max_h'			=>2500,					'files'			=>$filename,					'resize_path'	=>$file_path."crop/",					'resize_w'		=>350,					'resize_h'		=>500,					'resize_path_2'	=>"0",					'resize_w_2'	=>0,					'resize_h_2'	=>0				  ));			if($files_upload)			{				foreach($files_upload as $file_upload)				{					$now = date("Y-m-d H:i:s", time());					$query = "INSERT INTO `osc_sys_docs` (`cat`, `source`, `created`, `modified`) VALUES ('$item_id', '$file_upload', '$now', '$now')";										$ah->rs($query);									}			}		}	}else	{		$data['item_id'] = 0;	}	/*	$layouts_id = (isset($_POST['layout_id']) && $_POST['layout_id'] ? $_POST['layout_id'] : array());	if ($layouts_id) {		foreach ($layouts_id as $key => $value) {			$q = "UPDATE `osc_sys_townhouses_layouts` SET `townhouse_id` = '$item_id' WHERE `id` = '$value'";			$ah->rs($q,0,1);		}	}	*/	$data['item_id'] = $item_id;	$data['real_item_id'] = $item_id;	$data['message'] = "Категория документов успешно создана. ID =  $item_id";	$data['status'] = "success";	